import{A as e}from"./vendor.js";import{A as t,r as i,f as s,d as o,e as d}from"./root.js";var n=Object.defineProperty,l=Object.getOwnPropertyDescriptor;const r=e=>"video"===e.tagName.toLowerCase(),a=(e,t)=>{e.style.zIndex=t};class c{static add(e){const t=document.createElement("style");t.id="video-ios-fix",t.innerHTML=`#${e}:not(:-webkit-full-screen){display: none;}`,document.head.appendChild(t)}static remove(){const e=document.querySelector("style#video-ios-fix");e&&e.remove()}}class h{constructor(e,t,i){this.type=i?"youtube":"video",this.elm=i?this.createYoutube(i):this.createVideo(e,t)}createVideo(e,t){const i=document.createElement("video");return i.id="video-review",i.controls=!0,i.preload="none",[t,e].forEach((e=>{if(e){const s=e===t,o=document.createElement("source");o.src=e,o.type=s?"video/webm":"video/mp4",i.appendChild(o)}})),i}createYoutube(e){const t=document.createElement("iframe");return t.id="youtube-video-review",t.src=e,t.style.cssText="\n      position: absolute;\n      top: 0; \n      left: 0;\n      width: 100%;\n      height: 100%;\n    ",t.title="YouTube video player",t.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope",t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen",""),t}}class m extends h{constructor(e,t,i){super(e,t,i),this.isInit=!1,this.elm.style.position="absolute"}add(){document.body.appendChild(this.elm)}remove(){this.elm.remove()}destroy(){this.isInit&&(this.isInit=!1,this.remove(),c.remove())}init(){this.isInit||(this.isInit=!0,this.add(),c.add(this.elm.id))}}class u{constructor(e,t,i){this.src="",this.video=new m(e,t,i),this.video.init(),this.addEvents()}handleFullscreenchange(){if(null===document.fullscreenElement||null===document.webkitFullscreenElement){const e=this.video.elm;r(e)?e.pause():(this.src=this.src?this.src:e.src,e.src=""),e.style.display="none",a(e,"")}}addEvents(){this.video.elm.addEventListener("fullscreenchange",this.handleFullscreenchange),this.video.elm.addEventListener("webkitfullscreenchange",this.handleFullscreenchange)}removeEvents(){this.video.elm.removeEventListener("fullscreenchange",this.handleFullscreenchange),this.video.elm.removeEventListener("webkitfullscreenchange",this.handleFullscreenchange)}show(){this.video.elm.style.display="",r(this.video.elm)?this.video.elm.play():this.src&&(this.video.elm.src=this.src),void 0!==document.documentElement.requestFullscreen?(this.video.elm.requestFullscreen(),a(this.video.elm,"10")):void 0!==document.documentElement.webkitRequestFullscreen&&(this.video.elm.webkitRequestFullscreen(),a(this.video.elm,"10"))}destroy(){this.removeEvents(),this.video.destroy()}}((e,t,i,s)=>{for(var o,d=s>1?void 0:s?l(t,i):t,r=e.length-1;r>=0;r--)(o=e[r])&&(d=(s?o(t,i,d):o(d))||d);s&&d&&n(t,i,d)})([s],u.prototype,"handleFullscreenchange",1);class v{constructor(i,s,n){this.videoInstance=new h(i,s,n),this.video=this.videoInstance.elm,this.elm=this.getTemplate(n||i||""),this.dialogContent=this.elm.querySelector(".dialog-content-wrapper"),this.dialog=new e(this.elm),this.dialog.on("show",(()=>{if(r(this.video)){const e=this.video.play();void 0!==e&&e.then((e=>{this.video.pause()}))}o(this.elm,t.scrollbar)})),this.dialog.on("hide",(()=>{r(this.video)?this.video.pause():"youtube"===this.videoInstance.type&&(this.video.src=this.video.src),d(this.elm,t.scrollbar)})),this.addToDOM()}getTemplate(e){e=e.slice(e.lastIndexOf("/"));const t=document.createElement("div");return t.id=`video-dialog-${e}`,t.classList.add("dialog-container","!z-100"),t.setAttribute("aria-labelledby","video-dialog-title"),t.setAttribute("aria-hidden","true"),t.dataset.testid="dialog",t.innerHTML='\n      \x3c!-- 2. The dialog overlay --\x3e\n      <div class="dialog-overlay  bg-true-black bg-opacity-50" data-a11y-dialog-hide></div>\n      \x3c!-- 3. The actual dialog --\x3e\n      <div class="dialog-content  relative w-4/5 mx-auto grid place-items-center" role="document">\n        \x3c!-- 5. The dialog title --\x3e\n        <h1 id="video-dialog-title" class="sr-only">Диалог просмотра видео отзыва.</h1>\n        \x3c!-- 6. Dialog content --\x3e\n        <div class="dialog-content-wrapper" style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; overflow: hidden;"></div>\n  </div>\n',t}addToDOM(){document.getElementById(this.elm.id)||(this.dialogContent.appendChild(this.video),document.body.appendChild(this.elm))}show(){this.dialog.show()}destroy(){this.dialog.destroy(),this.elm.remove()}}const p=e=>{const s={mp4:e.dataset.mp4,webm:e.dataset.webm,youtube:e.dataset.youtube};let o,d,n=t.isDesktop;e.addEventListener("click",(()=>{n?(d||(d=new v(s.mp4,s.webm,s.youtube)),d.show()):(o||(o=new u(s.mp4,s.webm,s.youtube)),o.show())})),i(document.documentElement,(()=>{n!==t.isDesktop&&(n=t.isDesktop,o&&(o.destroy(),o=void 0),d&&(d.destroy(),d=void 0))}))};export{p as reviewVideo};
