import{A as e}from"./vendor.js";import{A as t,r as i,f as s,d as o,e as d}from"./root.js";var l=Object.defineProperty,n=Object.getOwnPropertyDescriptor;const a=e=>"video"===e.tagName.toLowerCase(),r=(e,t)=>{e.style.zIndex=t};class c{static add(e){const t=document.createElement("style");t.id="video-ios-fix",t.innerHTML=`#${e}:not(:-webkit-full-screen){display: none;}`,document.head.appendChild(t)}static remove(){const e=document.querySelector("style#video-ios-fix");e&&e.remove()}}class h{constructor(e,t,i){this.type=i?"youtube":"video",this.elm=i?this.createYoutube(i):this.createVideo(e,t)}createVideo(e,t){const i=document.createElement("video");return i.id="video-review",i.controls=!0,i.preload="none",[t,e].forEach((e=>{if(e){const s=e===t,o=document.createElement("source");o.src=e,o.type=s?"video/webm":"video/mp4",i.appendChild(o)}})),i}createYoutube(e){const t=document.createElement("iframe");return t.id="youtube-video-review",t.src=e,t.style.cssText="\n      position: absolute;\n      top: 0; \n      left: 0;\n      width: 100%;\n      height: 100%;\n    ",t.title="YouTube video player",t.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope",t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen",""),t}}class m extends h{constructor(e,t,i){super(e,t,i),this.isInit=!1,this.elm.style.position="absolute"}add(){document.body.appendChild(this.elm)}remove(){this.elm.remove()}destroy(){this.isInit&&(this.isInit=!1,this.remove(),c.remove())}init(){this.isInit||(this.isInit=!0,this.add(),c.add(this.elm.id))}}class u{constructor(e,t,i){this.src="",this.video=new m(e,t,i),this.video.init(),this.addEvents()}handleFullscreenchange(){if(null===document.fullscreenElement||null===document.webkitFullscreenElement){const e=this.video.elm;a(e)?e.pause():(this.src=this.src?this.src:e.src,e.src=""),e.style.display="none",r(e,"")}}addEvents(){this.video.elm.addEventListener("fullscreenchange",this.handleFullscreenchange),this.video.elm.addEventListener("webkitfullscreenchange",this.handleFullscreenchange)}removeEvents(){this.video.elm.removeEventListener("fullscreenchange",this.handleFullscreenchange),this.video.elm.removeEventListener("webkitfullscreenchange",this.handleFullscreenchange)}show(){this.video.elm.style.display="",a(this.video.elm)?this.video.elm.play():this.src&&(this.video.elm.src=this.src),void 0!==document.documentElement.requestFullscreen?(this.video.elm.requestFullscreen(),r(this.video.elm,"10")):void 0!==document.documentElement.webkitRequestFullscreen&&(this.video.elm.webkitRequestFullscreen(),r(this.video.elm,"10"))}destroy(){this.removeEvents(),this.video.destroy()}}((e,t,i,s)=>{for(var o,d=s>1?void 0:s?n(t,i):t,a=e.length-1;a>=0;a--)(o=e[a])&&(d=(s?o(t,i,d):o(d))||d);s&&d&&l(t,i,d)})([s],u.prototype,"handleFullscreenchange",1);class v{constructor(i,s,l){this.videoInstance=new h(i,s,l),this.video=this.videoInstance.elm,this.elm=this.getTemplate(l||i||""),this.dialogContent=this.elm.querySelector(".dialog-content-wrapper"),this.dialog=new e(this.elm),this.dialog.on("show",(()=>{if(a(this.video)){const e=this.video.play();void 0!==e&&e.then((e=>{this.video.pause()}))}o(this.elm,t.scrollbar)})),this.dialog.on("hide",(()=>{a(this.video)?this.video.pause():"youtube"===this.videoInstance.type&&(this.video.src=this.video.src),d(this.elm,t.scrollbar)})),this.addToDOM()}getTemplate(e){e=e.slice(e.lastIndexOf("/"));const t=document.createElement("div");return t.id=`video-dialog-${e}`,t.classList.add("dialog-container","!z-100"),t.setAttribute("aria-labelledby","video-dialog-title"),t.setAttribute("aria-hidden","true"),t.dataset.testid="dialog",t.innerHTML='\n      \x3c!-- 2. The dialog overlay --\x3e\n      <div class="dialog-overlay  bg-true-black bg-opacity-50" data-a11y-dialog-hide></div>\n      \x3c!-- 3. The actual dialog --\x3e\n      <div class="dialog-content  relative w-4/5 mx-auto grid place-items-center" role="document">\n        \x3c!-- 5. The dialog title --\x3e\n        <h1 id="video-dialog-title" class="sr-only">Диалог просмотра видео отзыва.</h1>\n        <button class="absolute -top-12 right-0 w-7 h-7 md:hidden" type="button" data-a11y-dialog-hide aria-label="Закрыть видео."><svg fill="none" viewBox="0 0 28 28" aria-hidden="true"><path fill="#fff" d="M27.965 3.217 24.748 0 0 24.747l3.214 3.218 24.75-24.748Z"/><path fill="#fff" d="m24.748 27.966 3.217-3.217L3.218.002 0 3.216l24.748 24.75Z"/></svg></button\n        \x3c!-- 6. Dialog content --\x3e\n        <div class="dialog-content-wrapper h-65vh md:h-0 md:pb-[56.25%]" style="position: relative; width: 100%; overflow: hidden;"></div>\n  </div>\n',t}addToDOM(){document.getElementById(this.elm.id)||(this.dialogContent.appendChild(this.video),document.body.appendChild(this.elm))}show(){this.dialog.show()}destroy(){this.dialog.destroy(),this.elm.remove()}}const p=e=>{const s={mp4:e.dataset.mp4,webm:e.dataset.webm,youtube:e.dataset.youtube};let o=t.isDesktop;const d=!!s.youtube;let l,n;e.addEventListener("click",(()=>{o||d?(n||(n=new v(s.mp4,s.webm,s.youtube)),n.show()):(l||(l=new u(s.mp4,s.webm,s.youtube)),l.show())})),i(document.documentElement,(()=>{o!==t.isDesktop&&(o=t.isDesktop,l&&(l.destroy(),l=void 0),n&&(n.destroy(),n=void 0))}))};export{p as reviewVideo};
